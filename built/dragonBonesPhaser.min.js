/**
 * git: https://github.com/raksa/phaser-dragonbones
 */

var __extends=this&&this.__extends||function(){var b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,l){b.__proto__=l}||function(b,l){for(var a in l)l.hasOwnProperty(a)&&(b[a]=l[a])};return function(g,l){function a(){this.constructor=g}b(g,l);g.prototype=null===l?Object.create(l):(a.prototype=l.prototype,new a)}}(),Rift;
(function(b){var g=function(l){function a(c,d){var f=l.call(this,c,d)||this;f.Suffix="DragonBonesPlugin";f.ImageSuffix="_Image_"+f.Suffix;f.TextureSuffix="_TextureMap_"+f.Suffix;f.BonesSuffix="_Bones_"+f.Suffix;return a.instance=f}__extends(a,l);a.prototype.AddResourceByName=function(c,a,f,e){this.AddResources(c,[new b.DragonBonesPlugin.Resource(b.DragonBonesPlugin.ResType.Image,e),new b.DragonBonesPlugin.Resource(b.DragonBonesPlugin.ResType.TextureMap,f),new b.DragonBonesPlugin.Resource(b.DragonBonesPlugin.ResType.Bones,
a)])};a.prototype.AddResources=function(a,d){for(var c=0;c<d.length;c++)this.AddResource(a,d[c])};a.prototype.AddResource=function(c,d){c=c.toLowerCase();var f=!1,e;for(e in a.ObjDictionary)if(e==c){0==a.ObjDictionary[e].Resources.filter(function(a){return a.Type===d.Type}).length&&a.ObjDictionary[e].Resources.push(d);f=!0;break}f||(a.ObjDictionary[c]=new a.Object([]),a.ObjDictionary[c].Resources.push(d))};a.prototype.LoadResources=function(){for(var c in a.ObjDictionary)for(var d=a.ObjDictionary[c].Resources,
f=0;f<d.length;f++){var e=d[f];if(!e.Loaded){switch(e.Type){case a.ResType.Image:this.game.load.image(c+this.ImageSuffix,e.FilePath);break;case a.ResType.TextureMap:this.game.load.json(c+this.TextureSuffix,e.FilePath);break;case a.ResType.Bones:this.game.load.json(c+this.BonesSuffix,e.FilePath)}e.Loaded=!0}}};a.prototype.CreateFactoryItem=function(c){c=c.toLowerCase();for(var d in a.ObjDictionary)if(!c||d==c){c=new a.Object(a.ObjDictionary[d].Resources);for(var f=null,e=null,k=null,h=0;h<c.Resources.length;h++)switch(c.Resources[h].Type){case a.ResType.Image:f=
this.game.cache.getItem(d+this.ImageSuffix,b.DragonBonesPlugin.IMAGE).data;break;case a.ResType.TextureMap:e=this.game.cache.getItem(d+this.TextureSuffix,b.DragonBonesPlugin.JSON).data;break;case a.ResType.Bones:k=this.game.cache.getItem(d+this.BonesSuffix,b.DragonBonesPlugin.JSON).data}c.Skeleton=c.Factory.parseDragonBonesData(k);c.Factory.parseTextureAtlasData(e,f);return c}return null};a.prototype.GetArmature=function(a,d){var c=this.CreateFactoryItem(a);null==d&&(d=c.Skeleton.armatureNames[0]);
var e=c.Factory.buildArmatureDisplay(d);c.Armature=e;this.RefreshClock();return c.Armature};a.prototype.RefreshClock=function(){var a=!1,d=dragonBones.PhaserFactory._clockHandler;this.game.time.events.events.forEach(function(c,e,b){c.callback==d&&(a=!0)});a||this.game.time.events.loop(20,dragonBones.PhaserFactory._clockHandler,dragonBones.PhaserFactory)};return a}(Phaser.Plugin);g.ObjDictionary={};g.IMAGE=2;g.JSON=11;g.instance=null;b.DragonBonesPlugin=g;(function(b){var a=function(){return function(a){this.Factory=
new dragonBones.PhaserFactory(null,b.instance.game);this.Resources=a}}();b.Object=a;a=function(){return function(a,d){this.Loaded=!1;this.Type=a;this.FilePath=d}}();b.Resource=a;(function(a){a[a.Image=0]="Image";a[a.TextureMap=1]="TextureMap";a[a.Bones=2]="Bones"})(b.ResType||(b.ResType={}))})(g=b.DragonBonesPlugin||(b.DragonBonesPlugin={}))})(Rift||(Rift={}));
PIXI.Sprite.prototype.setTexture=function(b,g){void 0!==g&&this.texture.baseTexture.destroy();this.texture=b;this.texture.baseTexture.skipRender=!1;this.texture.valid=!0;this.cachedTint=-1};
PIXI.Sprite.prototype.getBounds=function(b){var g=b&&b instanceof PIXI.DisplayObject,l=!0;g?l=b instanceof PIXI.DisplayObjectContainer?b.contains(this):!1:b=this;var a;if(g){var c=b.worldTransform;b.worldTransform=PIXI.identityMatrix;for(a=0;a<b.children.length;a++)b.children[a].updateTransform()}var d=Infinity,f=Infinity,e=-Infinity,k=-Infinity,h,m,r=!1;for(a=0;a<this.children.length;a++)this.children[a].visible&&(r=!0,h=this.children[a].getBounds(),d=d<h.x?d:h.x,f=f<h.y?f:h.y,m=h.width+h.x,h=h.height+
h.y,e=e>m?e:m,k=k>h?k:h);m=this._bounds;if(!r){m=new PIXI.Rectangle;var n=m.x,e=m.width+m.x,k=m.y,r=m.height+m.y;a=this.worldTransform;var p=a.a,q=a.b,t=a.c,u=a.d,v=a.tx,w=a.ty,d=p*e+t*r+v,f=u*r+q*e+w;a=p*n+t*r+v;r=u*r+q*n+w;h=p*n+t*k+v;n=u*k+q*n+w;p=p*e+t*k+v;q=u*k+q*e+w;e=d;k=f;d=a<d?a:d;d=h<d?h:d;d=p<d?p:d;f=r<f?r:f;f=n<f?n:f;f=q<f?q:f;e=a>e?a:e;e=h>e?h:e;e=p>e?p:e;k=r>k?r:k;k=n>k?n:k;k=q>k?q:k}m.x=d;m.y=f;m.width=e-d;m.height=k-f;if(g)for(b.worldTransform=c,a=0;a<b.children.length;a++)b.children[a].updateTransform();
l||(b=b.getBounds(),m.x-=b.x,m.y-=b.y);return m};var dragonBones;
(function(b){var g=function(l){function a(a){var c=l.call(this,a,0,0,0)||this;c.maxX=0;c.maxY=0;c.game=a;return c}__extends(a,l);a.prototype.SetBounds=function(a){if(a||this.maxX<this.getBounds().width)this.maxX=this.getBounds().width;if(a||this.maxY<this.getBounds().height)this.maxY=this.getBounds().height;this.body.setSize(this.maxX/2,this.maxX/2,this.maxY,0)};a.prototype._onClear=function(){this._armature=null;this._debugDrawer&&(this._debugDrawer.destroy(!0),this._debugDrawer=null);this.destroy(!0)};
a.prototype._dispatchEvent=function(a){};a.prototype._debugDraw=function(a){this._debugDrawer||(this._debugDrawer=new Phaser.Graphics(this.game));if(a){this.addChild(this._debugDrawer);this._debugDrawer.clear();a=this._armature.getBones();for(var c=0,f=a.length;c<f;++c){var b=a[c],k=Math.max(b.length,5),h=b.globalTransformMatrix.tx,l=b.globalTransformMatrix.ty,g=h+b.globalTransformMatrix.a*k,k=l+b.globalTransformMatrix.b*k;this._debugDrawer.lineStyle(1,b.ik?16711680:65280,.5);this._debugDrawer.moveTo(h,
l);this._debugDrawer.lineTo(g,k)}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)};a.prototype.hasEvent=function(a){return!1};a.prototype.addEvent=function(a,d,b){};a.prototype.removeEvent=function(a,d,b){};a.prototype.advanceTimeBySelf=function(a){a?b.PhaserFactory._clock.add(this._armature):b.PhaserFactory._clock.remove(this._armature)};a.prototype.dispose=function(){this._armature&&(this.advanceTimeBySelf(!1),this._armature.dispose(),this._armature=
null)};Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0});return a}(Phaser.Sprite);b.PhaserArmatureDisplay=g})(dragonBones||(dragonBones={}));
(function(b){var g=function(l){function a(c,d){void 0===c&&(c=null);var f=l.call(this,c)||this;f.game=d;a._eventManager||(a._eventManager=new b.PhaserArmatureDisplay(d),a._clock=new b.WorldClock);return f}__extends(a,l);a._clockHandler=function(c){a._clock.advanceTime(-1)};Object.defineProperty(a,"factory",{get:function(c){a._factory||(a._factory=new a(null,c));return a._factory},enumerable:!0,configurable:!0});a.prototype._generateTextureAtlasData=function(a,d){a?a.texture=d:a=b.BaseObject.borrowObject(b.PhaserTextureAtlasData);
return a};a.prototype._generateArmature=function(c){var d=b.BaseObject.borrowObject(b.Armature),f=new b.PhaserArmatureDisplay(this.game);d._armatureData=c.armature;d._skinData=c.skin;d._animation=b.BaseObject.borrowObject(b.Animation);d._display=f;d._eventManager=a._eventManager;f._armature=d;d._animation._armature=d;d.animation.animations=c.armature.animations;return d};a.prototype._generateSlot=function(a,d){var c=b.BaseObject.borrowObject(b.PhaserSlot),e=d.slot,k=[];c.game=this.game;c.name=e.name;
c._rawDisplay=new Phaser.Sprite(this.game,0,0);c._meshDisplay=null;for(var h=0,l=d.displays.length;h<l;++h){var g=d.displays[h];switch(g.type){case 0:g.texture||(g.texture=this._getTextureData(a.dataName,g.name));k.push(c._rawDisplay);break;case 2:g.texture||(g.texture=this._getTextureData(a.dataName,g.name));k.push(c._meshDisplay);break;case 1:var n=this.buildArmature(g.name,a.dataName);if(n){if(!c.inheritAnimation){var p=0<e.actions.length?e.actions:n.armatureData.actions;if(0<p.length)for(var q=
0,t=p.length;q<t;++q)n._bufferAction(p[q]);else n.animation.play()}g.armature=n.armatureData}k.push(n);break;default:k.push(null)}}c._setDisplayList(k);return c};a.prototype.buildArmatureDisplay=function(a,d,b){void 0===d&&(d=null);void 0===b&&(b=null);(a=(a=this.buildArmature(a,d,b))?a._display:null)&&a.advanceTimeBySelf(!0);return a};a.prototype.getTextureDisplay=function(a,b){void 0===b&&(b=null);var c=this._getTextureData(b,a);if(c){if(!c.texture){var d=c.parent.texture,g=new Phaser.Rectangle(0,
0,c.region.width,c.region.height);c.texture=new PIXI.Texture(d,c.region,g)}return new Phaser.Sprite(this.game,0,0,c.texture)}return null};Object.defineProperty(a.prototype,"soundEventManater",{get:function(){return a._eventManager},enumerable:!0,configurable:!0});return a}(b.BaseFactory);g._factory=null;g._eventManager=null;g._clock=null;b.PhaserFactory=g})(dragonBones||(dragonBones={}));
(function(b){var g=function(b){function a(){return b.call(this)||this}__extends(a,b);a.toString=function(){return"[class dragonBones.PhaserSlot]"};a.prototype.set_game=function(){};a.prototype._onClear=function(){b.prototype._onClear.call(this);this._renderDisplay=null};a.prototype._initDisplay=function(a){};a.prototype._disposeDisplay=function(a){a.destroy()};a.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display||this._rawDisplay};a.prototype._addDisplay=function(){this._armature._display.addChild(this._renderDisplay)};
a.prototype._replaceDisplay=function(a){var c=this._armature._display;c.addChild(this._renderDisplay);c.swapChildren(this._renderDisplay,a);c.removeChild(a)};a.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)};a.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible};a.prototype._updateBlendMode=function(){};a.prototype._updateColor=function(){this._renderDisplay.alpha=this._colorTransform.alphaMultiplier};a.prototype._updateFilters=
function(){};a.prototype._updateFrame=function(){var a=this._renderDisplay;if(this._display){var b=this._displayIndex<this._displayDataSet.displays.length?this._displayDataSet.displays[this._displayIndex]:null,f=(this._displayIndex<this._replacedDisplayDataSet.length?this._replacedDisplayDataSet[this._displayIndex]:null)||b,e=f.texture;if(e){var g=e.parent.texture;if(!e.texture&&g){var h=new PIXI.Rectangle(0,0,e.region.width,e.region.height);e.texture=new PIXI.Texture(g,e.region,e.region,h,e.rotated)}h=
this._armature._replacedTexture||e.texture;this._updatePivot(b,f,e);h&&h.frame&&(a.setTexture(h),a.width=h.frame.width,a.height=h.frame.height,a.texture.baseTexture.skipRender=!1);h.baseTexture.resolution=1;h.baseTexture.source=g;this._updateVisible();return}}this._pivotY=this._pivotX=0;a.visible=!1;a.texture=null;a.x=this.origin.x;a.y=this.origin.y};a.prototype._updateMesh=function(){var a=0<this._ffdVertices.length;if(this._meshData.skinned)for(var a=0,b=this._meshData.vertices.length;a<b;a+=2)for(var f=
0,e=this._meshData.boneIndices[a/2].length;f<e;++f);else if(a)for(a=0,b=this._meshData.vertices.length;a<b;a+=2);};a.prototype._updateTransform=function(){this._renderDisplay.x=this.global.x;this._renderDisplay.y=this.global.y;this._renderDisplay.rotation=this.global.skewX;this._renderDisplay.scale.x=this.global.scaleX;this._renderDisplay.scale.y=this.global.scaleY;this._renderDisplay.pivot.x=this._pivotX;this._renderDisplay.pivot.y=this._pivotY};return a}(b.Slot);b.PhaserSlot=g})(dragonBones||(dragonBones=
{}));
(function(b){var g=function(a){function c(){return a.call(this)||this}__extends(c,a);c.toString=function(){return"[class dragonBones.PhaserTextureAtlasData]"};c.prototype._onClear=function(){a.prototype._onClear.call(this);this.texture&&(this.texture=null)};c.prototype.generateTextureData=function(){return b.BaseObject.borrowObject(l)};return c}(b.TextureAtlasData);b.PhaserTextureAtlasData=g;var l=function(a){function b(){return a.call(this)||this}__extends(b,a);b.toString=function(){return"[class dragonBones.PhaserTextureData]"};b.prototype._onClear=
function(){a.prototype._onClear.call(this);this.texture&&(this.texture.destroy(!1),this.texture=null)};return b}(b.TextureData);b.PhaserTextureData=l})(dragonBones||(dragonBones={}));